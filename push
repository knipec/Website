#!/bin/sh

cd "`dirname "$0"`"

git status | grep "Changes to be committed:\|Changes not staged for commit:\|Untracked files:" > /dev/null \
&& echo "$(tput bold)$(tput setaf 1)ERROR: Cannot commit. You have uncommitted changes:$(tput sgr0)"\
&& git status \
&& exit

jekyll build || exit
commit=`git rev-parse HEAD`

git checkout master || exit
exclude_flags="--exclude=${exclude// / --exclude=}"
rsync -rlv --exclude='*.md' _site/* . || exit
git add --all . || exit
git commit -m "Generated from $commit"
git push || exit

git checkout source || exit
git push || exit
