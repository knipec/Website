#!/bin/bash -e

cd "$(dirname "$0")"

git status | grep "Changes to be committed:\|Changes not staged for commit:\|Untracked files:" > /dev/null \
&& echo "$(tput bold)$(tput setaf 1)ERROR: Cannot commit. You have uncommitted changes:$(tput sgr0)"\
&& git status \
&& exit 1

jekyll build
commit="$(git rev-parse HEAD)"
tmp="$(mktemp -d)"
mv _site/* "$tmp"

git checkout master
rm -r *
mv "$tmp/*" .
git add --all .
git commit -m "Generated from $commit"
git push

git checkout source
git push
